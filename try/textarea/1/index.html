<style>
body {
    padding:0;
    margin:0;
}
</style>
<script src="../../../docs/lib/van/1.5.0/nomodule.min.js"></script>
<script>
window.addEventListener('DOMContentLoaded', (event) => {
    const textarea = van.tags.textarea({style:`width:100%;height:100%;box-sizing:border-box;resize:none;`,
            onkeyup:(e)=>countBlock(e),
            onkeydown:(e)=>countBlock(e),
        }

    )
    function countBlock(e) {
        const v = e.target.value
        console.log(v, e.target.selectionStart)
        const calletStr = v.substring(0, e.target.selectionStart) // 先頭からキャレット位置までの文字列
        const now = (calletStr.match(/[\n]{2,}/gm) || []).length + 1; // 2つ以上連続した改行の数
        const all = (v.match(/[\n]{2,}/gm) || []).length + 1; // 2つ以上連続した改行の数
        console.log(now, calletStr)
        console.log(all, v)
        console.log(`ブロック数: ${now}/${all}`)
    }
    van.add(document.body, textarea)
    /*
    const data = {
        values: van.state([]),
    }
    const listbox = van.tags.select({multiple:true}, [['a','A'],['b','B'],['c','C']].map(([k,v])=>van.tags.option({value:k},v)))
    van.add(document.body,
        van.tags.select({multiple:true,
               onchange:(e)=>{console.log(e.target.value, e.target.options, [...e.target.options].filter(o=>o.selected).map(o=>o.value));data.values.val=[...e.target.options].filter(o=>o.selected).map(o=>o.value);},
            }, 
            [['a','A'],['b','B'],['c','C']].map(([k,v])=>van.tags.option({value:k},v))),
        //van.tags.ul(data.values.val.map(v=>van.tags.li(v))),
        //van.tags.ul(()=>data.values.val.map(v=>van.tags.li(v))),
        //()=>van.tags.ul(()=>data.values.val.map(v=>van.tags.li(v))),
        ()=>van.tags.ul(data.values.val.map(v=>van.tags.li(v))),
    )
    document.querySelector('input,select,textarea').focus()
    */
    /*
    const textarea = document.querySelector('textarea')
    console.log(textarea)
    textarea.addEventListener('select', (event) => {
        console.log('select')
        console.log(textarea.selectionStart)
        console.log(textarea.selectionEnd)
    })
    // https://developer.mozilla.org/ja/docs/Web/API/HTMLTextAreaElement/selectionchange_event
    textarea.addEventListener('selectionchange', (event) => {
        console.log('selectionchange')
        console.log(textarea.selectionStart)
        console.log(textarea.selectionEnd)
    })
    textarea.addEventListener('input', (event) => {
        console.log(`input: ${textarea.selectionStart}, ${textarea.selectionEnd}`)
    })
    textarea.addEventListener('keydown', (event) => {
        console.log(`keydown: ${textarea.selectionStart}, ${textarea.selectionEnd}`)
    })
    textarea.addEventListener('keyup', (event) => {
        console.log(`keyup: ${textarea.selectionStart}, ${textarea.selectionEnd}`)
    })




    textarea.dispatchEvent(new Event('select'))
    */
});
</script>
